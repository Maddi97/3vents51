<div fxLayout="row">
    <div class="form-and-image-upload">
        <app-event-form (updateEvent)="updateEvent($event)" (addNewEvent)="addNewEvent($event)"
                        [organizersIn]="organizers"
                        [eventIn]="eventIn"></app-event-form>
    </div>
    <div style="width: 90%; margin-top: 3em;">
        <mat-accordion>
            <div *ngFor="let category of categories" fxLayout="column" fxLayoutAlign="center center">
                <mat-expansion-panel style="max-width: 100%; width: 100%; margin-top: 1em;"
                                     (afterExpand)="loadOrganizerOnSubcategories(category)">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{category.name}}
                        </mat-panel-title>
                        <mat-panel-description>
                            Open to see all organizers
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <div *ngFor="let organizer of organizers" fxLayout="column" fxLayoutAlign="center center">
                        <mat-expansion-panel style="max-width: 100%; width: 100%; margin-top: 1em;"
                                             [ngStyle]="{'background': getColor(organizer)}"
                                             (afterExpand)="loadEvents(organizer._id, category._id)">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{organizer.name}}
                                </mat-panel-title>
                                <mat-panel-description>
                                    Open to see all events
                                </mat-panel-description>
                                <p>Last Updated: {{ timeSince(organizer.lastUpdated) }}</p>
                            </mat-expansion-panel-header>

                            <div *ngFor="let event of allFilteredEvents" fxLayout="row">
                                <div style="width: 85%; height: 2rem; background-color: rgb(214, 214, 214); margin-bottom: .2rem; border-radius: 5px; cursor: pointer;"
                                     fxLayout="row">
                                    <div style="width: 80%;" fxLayoutAlign="start center" (click)="eventIn = event">
                                        {{event.name}}
                                    </div>
                                    <img class="event-image"
                                         [src]="event.eventImageTemporaryURL">
                                    <div (click)="deleteEvent(organizer._id, event._id)"
                                         style="width: 20%; background-color: red; border-radius: 5px; cursor: pointer;"
                                         fxLayoutAlign="center center">
                                        Delete
                                    </div>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </div>


                </mat-expansion-panel>
            </div>
        </mat-accordion>
        <div style="margin-top: 2em;">
            <app-map-view [markerData]="allFilteredEvents"></app-map-view>
        </div>

        <div class="all-events-expansion-panel" *ngFor="let category of categories">
            <mat-expansion-panel style="max-width: 100%; width: 100%; margin-top: 1em;"
                                 (afterExpand)="loadEventsByCategory(category)">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        {{category.name}}
                    </mat-panel-title>
                    <mat-panel-description>
                        Open to see all events
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div *ngFor="let event of allFilteredEvents" fxLayout="row">
                    <div style="width: 85%; height: 2rem; background-color: rgb(214, 214, 214); margin-bottom: .2rem; border-radius: 5px; cursor: pointer;"
                         fxLayout="row">
                        <div style="width: 80%;" fxLayoutAlign="start center"
                             (click)="eventIn = event">
                            {{event.name}}
                        </div>
                        <img class="event-image" [src]="event.eventImageTemporaryURL">
                        <div (click)="deleteEvent(event._organizerId, event._id)"
                             style="width: 20%; background-color: red; border-radius: 5px; cursor: pointer;"
                             fxLayoutAlign="center center">
                            Delete
                        </div>
                    </div>
                </div>
            </mat-expansion-panel>
        </div>

        <div class="all-hot-events-expansion-panel">
            <mat-expansion-panel style="max-width: 100%; width: 100%; margin-top: 1em;" (afterExpand)="getHotEvents()">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        All Hot Events
                    </mat-panel-title>
                    <mat-panel-description>
                        Open to see all events
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div *ngFor="let event of allFilteredEvents" fxLayout="row">
                    <div style="width: 85%; height: 2rem; background-color: rgb(214, 214, 214); margin-bottom: .2rem; border-radius: 5px; cursor: pointer;"
                         fxLayout="row">
                        <div style="width: 80%;" fxLayoutAlign="start center" (click)="eventIn = event">
                            {{event.name}}
                        </div>
                        <img class="event-image" [src]="event.eventImageTemporaryURL">
                        <div (click)="deleteEvent(event._organizerId, event._id)"
                             style="width: 20%; background-color: red; border-radius: 5px; cursor: pointer;"
                             fxLayoutAlign="center center">
                            Delete
                        </div>
                    </div>
                </div>
            </mat-expansion-panel>
        </div>
    </div>
</div>
